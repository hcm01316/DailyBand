<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='utf-8' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.13/index.global.min.js'></script>
    <style>
        #calendar {
            width: 80vw;
            height: 80vh;
        }

        #yrModal {
            position: fixed;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1000;
            top: 0;
            left: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #modalContent {
            width: 400px;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
        }

        #modalContent h1 {
            margin-top: 0;
        }

        #modalContent input[type="text"],
        #modalContent input[type="time"],
        #modalContent input[type="color"],
        #modalContent button {
            margin-bottom: 10px;
        }

        #modalContent button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #modalContent button:hover {
            background-color: #0056b3;
        }
    </style>
    <script>

        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth'
            });
            calendar.render();
        });

    </script>
</head>
<body>
<div id="yrModal" style="display:none;">
    <div id="modalContent">
        <h1>일정 추가 모달</h1>
        <label for="schStart">시작일:</label>
        <input type="text" id="schStart" value=""><br>
        <label for="schStartTime">시작시간:</label>
        <input type="time" id="schStartTime" value=""><br>
        <label for="schEnd">종료일:</label>
        <input type="text" id="schEnd" value=""><br>
        <label for="schEndTime">종료시간:</label>
        <input type="time" id="schEndTime" value=""><br>
        <label for="schTitle">제목:</label>
        <input type="text" id="schTitle" value=""><br>
        <input type="checkbox" id="allDay">
        <label for="allDay">하루종일</label><br>
        <label for="schBColor">배경색:</label>
        <input type="color" id="schBColor" value=""><br>
        <label for="schFColor">글자색:</label>
        <input type="color" id="schFColor" value=""><br>
        <button onclick="fCalAdd()">추가</button>
        <button onclick="fMClose()">닫기</button>
    </div>
</div>
<div id="Wrapper">
    <div id='calendar'></div>
</div>

<script>
    const YrModal = document.querySelector("#yrModal");
    const calendarEl = document.querySelector('#calendar');
    const mySchStart = document.querySelector("#schStart");
    const mySchStartTime = document.querySelector("#schStartTime");
    const mySchEnd = document.querySelector("#schEnd");
    const mySchEndTime = document.querySelector("#schEndTime");
    const mySchTitle = document.querySelector("#schTitle");
    const mySchAllday = document.querySelector("#allDay");
    const mySchBColor = document.querySelector("#schBColor");
    const mySchFColor = document.querySelector("#schFColor");

    const calendarOption = {
        height: '700px',
        expandRows: true,
        headerToolbar: {
            left: 'prevYear,prev,next,nextYear today',
            center: 'title',
            right: 'dayGridMonth,dayGridWeek,timeGridDay'
        },
        initialView: 'dayGridMonth',
        locale: 'kr',
        selectable: true,
        selectMirror: true,
        navLinks: true,
        editable: true,
        dayMaxEventRows: true,
        nowIndicator: true,
        eventSources: ['./commonEvents.json', './KYREvents.json', './SYREvents.json']
    }

    const calendar = new FullCalendar.Calendar(calendarEl, calendarOption);
    calendar.render();

    calendar.on("select", info => {
        mySchStart.value = info.startStr;
        mySchEnd.value = info.endStr;
        YrModal.style.display = "flex";
    });

    function fCalAdd() {
        if (!mySchTitle.value) {
            alert("제목을 입력하세요.");
            mySchTitle.focus();
            return;
        }

        let bColor = mySchBColor.value;
        let fColor = mySchFColor.value;
        if (fColor == bColor) {
            bColor = "black";
            fColor = "yellow";
        }

        let event = {
            title: mySchTitle.value,
            allDay: mySchAllday.checked,
            backgroundColor: bColor,
            textColor: fColor
        };

        if (mySchAllday.checked) {
            // 하루 종일 이벤트
            event.start = mySchStart.value;
            event.end = mySchEnd.value;
        } else {
            // 시간이 지정된 이벤트
            event.start = mySchStart.value + 'T' + mySchStartTime.value;
            event.end = mySchEnd.value + 'T' + mySchEndTime.value;
        }

        calendar.addEvent(event);
        fMClose();
    }

    function fMClose() {
        YrModal.style.display = "none";
    }
    calendar.on('eventClick', function(info) {
        if (confirm("정말로 이 일정을 삭제하시겠습니까?")) {
            info.event.remove();
        }
    });

</script>
</body>
</html>
