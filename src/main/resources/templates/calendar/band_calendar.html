<!DOCTYPE html>
<html lang='en' xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset='utf-8'/>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.13/index.global.min.js'></script>
    <style>
        #yrModal {
            position: fixed;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1000;
            top: 0;
            left: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #modalContent {
            width: 400px;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
        }

        #modalContent h1 {
            margin-top: 0;
        }

        #modalContent input[type="text"],
        #modalContent input[type="time"],
        #modalContent input[type="color"],
        #modalContent button {
            margin-bottom: 10px;
        }

        #modalContent button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #modalContent button:hover {
            background-color: #0056b3;
        }
    </style>
    <title>밴드 일정</title>
    <script>

        document.addEventListener('DOMContentLoaded', function () {
            const calendarEl = document.querySelector('#calendar');
            const mySchStart = document.querySelector("#schStart");
            const mySchStartTime = document.querySelector("#schStartTime");
            const mySchEnd = document.querySelector("#schEnd");
            const mySchEndTime = document.querySelector("#schEndTime");
            const mySchTitle = document.querySelector("#schTitle");
            const mySchAllday = document.querySelector("#allDay");
            const mySchBColor = document.querySelector("#schBColor");
            const mySchFColor = document.querySelector("#schFColor");
            const YrModal = document.querySelector("#yrModal");

            const calendarOption = {
                height: '700px',
                expandRows: true,
                headerToolbar: {
                    left: 'prevYear,prev,next,nextYear today',
                    center: 'title',
                    right: 'dayGridMonth,dayGridWeek,timeGridDay'
                },
                initialView: 'dayGridMonth',
                locale: 'kr',
                selectable: true,
                selectMirror: true,
                navLinks: true,
                editable: true,
                dayMaxEventRows: true,
                nowIndicator: true,
                eventSources: ['./commonEvents.json', './KYREvents.json', './SYREvents.json']
            }

            const calendar = new FullCalendar.Calendar(calendarEl, calendarOption);
            calendar.render();

            calendar.on("select", info => {
                mySchStart.value = info.startStr;
                let endDate = new Date(info.endStr); // 종료일을 선택한 날짜로 설정
                endDate.setDate(endDate.getDate() - 1); // 하루를 빼서 시작일과 종료일을 동일하게 설정
                mySchEnd.value = endDate.toISOString().split('T')[0];
                YrModal.style.display = "flex";
            });

            calendar.on('eventClick', function (info) {
                if (confirm("정말로 이 일정을 삭제하시겠습니까?")) {
                    info.event.remove();
                }
            });

            function fCalAdd() {
                if (!mySchTitle.value) {
                    alert("제목을 입력하세요.");
                    mySchTitle.focus();
                    return;
                }

                let bColor = mySchBColor.value;
                let fColor = mySchFColor.value;
                if (fColor == bColor) {
                    bColor = "black";
                    fColor = "yellow";
                }

                let event = {
                    title: mySchTitle.value,
                    allDay: mySchAllday.checked,
                    backgroundColor: bColor,
                    textColor: fColor
                };

                if (mySchAllday.checked) {
                    // 하루 종일 이벤트
                    event.start = mySchStart.value;
                    event.end = mySchEnd.value;
                } else {
                    // 시간이 지정된 이벤트
                    event.start = mySchStart.value + 'T' + mySchStartTime.value;
                    event.end = mySchEnd.value + 'T' + mySchEndTime.value;
                }

                calendar.addEvent(event);
                fMClose();
            }

            function fMClose() {
                YrModal.style.display = "none";
            }

            window.fCalAdd = fCalAdd;
            window.fMClose = fMClose;
        });

    </script>
</head>
<body>
<div class="page">
    <th:block th:include="dailyband/navbar :: navbarFragment"></th:block>
    <th:block th:include="dailyband/header :: headerFragment"></th:block>
    <div class="page-wrapper">
        <!-- Page header -->
        <div class="page-header d-print-none">
            <div class="container-xl">
                <div class="row g-2 align-items-center">
                    <div class="col">
                        <h2 class="page-title">
                            밴드 일정
                        </h2>
                    </div>
                </div>
            </div>
        </div>
        <!-- Page body -->
        <div class="page-body">
            <div class="container-xl">
                <div id="yrModal" style="display:none;">
                    <div id="modalContent">
                        <h1>일정 추가 모달</h1>
                        <label for="schStart">시작일:</label>
                        <input type="text" id="schStart" th:value="${schStart}"><br>
                        <label for="schStartTime">시작시간:</label>
                        <input type="time" id="schStartTime" th:value="${schStartTime}"><br>
                        <label for="schEnd">종료일:</label>
                        <input type="text" id="schEnd" th:value="${schEnd}"><br>
                        <label for="schEndTime">종료시간:</label>
                        <input type="time" id="schEndTime" th:value="${schEndTime}"><br>
                        <label for="schTitle">제목:</label>
                        <input type="text" id="schTitle" th:value="${schTitle}"><br>
                        <input type="checkbox" id="allDay" th:checked="${allDay}">
                        <label for="allDay">하루종일</label><br>
                        <label for="schBColor">배경색:</label>
                        <input type="color" id="schBColor" th:value="${schBColor}"><br>
                        <label for="schFColor">글자색:</label>
                        <input type="color" id="schFColor" th:value="${schFColor}"><br>
                        <button onclick="fCalAdd()">추가</button>
                        <button onclick="fMClose()">닫기</button>
                    </div>
                </div>
                <div id="Wrapper">
                    <div id='calendar'></div>
                </div>
            </div>
        </div>
        <th:block th:include="dailyband/footer :: footerFragment"></th:block>
    </div>
</div>

</body>
</html>
