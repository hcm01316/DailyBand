<?xml version="1.0" encoding="UTF-8"?>
<!-- SQL 맵퍼 파일은 xml이기 때문에 제일 먼저 xml 선언이 옵니다. -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bnd.dailyband.mybatis.mapper.RboardMapper">

	<select id="getListCount" resultType="int">
 		select COUNT(*) from RCRIT_BBS;
	</select>

	<select id="getRboardList" resultType="Rlist">
		SELECT * FROM (
		SELECT *,
		(@row_number:=@row_number + 1) AS rnum
		FROM (
		SELECT RCRIT_BBS.BBS_SN,
		BAND_TEAM_NM,
		RCRIT_GENRE_ID,
		RCRIT_AREA_ID,
		RCRIT_REALM_ID,
		MBR_NCNM,
		MBR_PROFL_PHOTO,
		RCRIT_STTUS_CD,
		RCRIT_NOPE,
		RCRIT_BBS.REG_DT,
		BBS_READ_CNT
		FROM RCRIT_BBS
		LEFT OUTER JOIN MBR_INFO ON RCRIT_BBS.MBR_ID = MBR_INFO.MBR_ID
		ORDER BY BBS_SN DESC
		) AS j, (SELECT @row_number:=0) AS temp
		) AS result
		WHERE rnum &gt;= #{start} and rnum &lt;= #{end}
	</select>

	<select id="getCtgryList" resultType="Ctgry">
		select CTGRY_NM,CTGRY_ID from BAND_CTGRY where CTGRY_TY = #{type};
	</select>

	<insert id="insertRboard">
		insert into RCRIT_BBS (MBR_ID,RCRIT_REALM_ID,RCRIT_GENRE_ID,RCRIT_AREA_ID,BAND_TEAM_NM,BBS_CN,RCRIT_NOPE)
		VALUES (#{MBR_ID},#{RCRIT_REALM_ID},#{RCRIT_GENRE_ID},#{RCRIT_AREA_ID},#{BAND_TEAM_NM},#{BBS_CN},#{RCRIT_NOPE});
	</insert>

	<update id="setReadCountUpdate" >
		update RCRIT_BBS
		set BBS_READ_CNT = BBS_READ_CNT+1
		WHERE BBS_SN=#{number}
	</update>

	<select id = "getDetail" resultType="rboard">
		select BBS_SN,MBR_ID,RCRIT_REALM_ID,RCRIT_GENRE_ID,RCRIT_AREA_ID,BAND_TEAM_NM,BBS_CN,RCRIT_NOPE,BBS_READ_CNT,REG_DT
		from RCRIT_BBS
		where BBS_SN=#{rboard}
	</select>

	<select id="bandck" resultType="Rboard">
		select BBS_SN from BAND_PRPT_INFO where MBR_PRPT_STTUS IN (1,2) and MBR_ID = #{id};
	</select>

	<select id="leaderck" resultType="int">
		select MBR_PRPT_STTUS from BAND_PRPT_INFO where MBR_PRPT_STTUS IN (1,2) and MBR_ID = #{id};
	</select>

	<select id="getbandList" resultType="Bandhr">
		SELECT BAND_PRPT_INFO.MBR_ID,MBR_NCNM,MBR_AGE,MBR_GENDER,MBR_PREFER_AREA, MBR_ACT_REALM,MBR_PREFER_GENRE, MBR_PROFL_PHOTO,MBR_PRPT_STTUS,BBS_SN
		FROM BAND_PRPT_INFO
		LEFT JOIN MBR_INFO ON MBR_INFO.MBR_ID = BAND_PRPT_INFO.MBR_ID
		WHERE BBS_SN = #{bandck} AND MBR_PRPT_STTUS IN (1, 2)
		ORDER BY MBR_PRPT_STTUS DESC;
	</select>

	<update id="bandaccept">
		update BAND_PRPT_INFO
		set MBR_PRPT_STTUS = 1 WHERE MBR_ID = #{id} and BBS_SN = #{num};
	</update>

	<select id="isjoin" resultType="int">
		select count(*) from BAND_PRPT_INFO where MBR_ID = #{id};
	</select>

	<insert id="join">
		insert into BAND_PRPT_INFO (MBR_ID,BBS_SN,MBR_PRPT_STTUS)
		values (#{id},#{num},0);
	</insert>

	<delete id="joinwatingdel">
	  	delete from  BAND_PRPT_INFO
	  	where MBR_ID = #{id} and MBR_PRPT_STTUS = 0;
	</delete>

	<select id="getjoinlist" resultType="Bandhr">
		SELECT BAND_PRPT_INFO.MBR_ID,MBR_NCNM,MBR_AGE,MBR_GENDER,MBR_PREFER_AREA, MBR_ACT_REALM,MBR_PREFER_GENRE, MBR_PROFL_PHOTO,MBR_PRPT_STTUS,BBS_SN
		FROM BAND_PRPT_INFO
				 LEFT JOIN MBR_INFO ON MBR_INFO.MBR_ID = BAND_PRPT_INFO.MBR_ID
		WHERE BBS_SN = #{bandck} AND MBR_PRPT_STTUS = 0;
	</select>

	<select id="myband" resultType="int">
		select BBS_SN from BAND_PRPT_INFO where MBR_PRPT_STTUS IN (1, 2) and MBR_ID = #{id};
	</select>

	<delete id="resign">
		delete from BAND_PRPT_INFO
		where MBR_ID = #{id} and BBS_SN = #{num};
	</delete>

	<delete id="refuse">
		delete from BAND_PRPT_INFO
		where MBR_ID = #{id} and BBS_SN = #{num};
	</delete>

	<delete id="breakup">
		delete from RCRIT_BBS
		where BBS_SN = #{num};
	</delete>

	<insert id="insertBand">
		insert BAND_PRPT_INFO (BBS_SN,MBR_ID,MBR_PRPT_STTUS)
		values (#{num},#{id},2);
	</insert>
</mapper>

